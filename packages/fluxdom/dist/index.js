"use strict";var J=Object.defineProperty;var K=(e,t,r)=>t in e?J(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var d=(e,t,r)=>K(e,typeof t!="symbol"?t+"":t,r);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});function A(e){return Object.assign(e,{use(t){const r=t(e);return r?typeof r=="object"||typeof r=="function"?"use"in r?r:A(r):r:e}})}const M=()=>{};class Q{constructor(t){d(this,"_listeners");d(this,"_settledPayload");d(this,"_isSettled",!1);d(this,"size",()=>this._listeners.size);d(this,"settled",()=>this._isSettled);d(this,"on",(t,r)=>{let n;if(r===void 0)n=Array.isArray(t)?t:[t];else{const s=t,i=Array.isArray(r)?r:[r];n=[u=>{const h=s(u);if(h)for(let y=0;y<i.length;y++)i[y](h.value)}]}if(this._isSettled){const s=this._settledPayload;for(let i=0;i<n.length;i++)n[i](s);return M}const o=this._listeners;for(let s=0;s<n.length;s++)o.add(n[s]);return()=>{for(let s=0;s<n.length;s++)o.delete(n[s])}});d(this,"emit",t=>{this._isSettled||this._doEmit(t,!1,!1)});d(this,"emitLifo",t=>{this._isSettled||this._doEmit(t,!1,!0)});d(this,"clear",()=>{this._listeners.clear()});d(this,"emitAndClear",t=>{this._isSettled||this._doEmit(t,!0,!1)});d(this,"emitAndClearLifo",t=>{this._isSettled||this._doEmit(t,!0,!0)});d(this,"settle",t=>{this._isSettled||(this._settledPayload=t,this._isSettled=!0,this._doEmit(t,!0,!1))});d(this,"_doEmit",(t,r,n)=>{const o=this._listeners,s=o.size;if(s===0)return;const i=Array.from(o);if(r&&o.clear(),n)for(let u=s-1;u>=0;u--)i[u](t);else for(let u=0;u<s;u++)i[u](t)});this._listeners=new Set(t)}}function _(e){return new Q(e)}function U(e,t){return Object.is(e,t)}function w(e,t,r=Object.is){if(Object.is(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;const n=Object.keys(e),o=Object.keys(t);if(n.length!==o.length)return!1;for(const s of n)if(!Object.prototype.hasOwnProperty.call(t,s)||!r(e[s],t[s]))return!1;return!0}function N(e,t){return w(e,t,w)}function B(e,t){return w(e,t,N)}function O(e,t){if(Object.is(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let o=0;o<e.length;o++)if(!O(e[o],t[o]))return!1;return!0}if(Array.isArray(t))return!1;const r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(const o of r)if(!Object.prototype.hasOwnProperty.call(t,o)||!O(e[o],t[o]))return!1;return!0}function C(e){return!e||e==="strict"?U:e==="shallow"?w:e==="shallow2"?N:e==="shallow3"?B:e==="deep"?O:e}function W(e){return C(e)}function $(e){const t=e;let r=e;return Object.assign((...n)=>r(...n),{getOriginal:()=>t,getCurrent:()=>r,setCurrent(n){r=n}})}function H(e){return typeof e=="function"&&"getOriginal"in e&&"getCurrent"in e&&"setCurrent"in e}function X(e,t,r){return e?typeof t=="function"?H(e.value)?(e.value.setCurrent(t),[e.value,!0]):[$(t),!1]:t&&t instanceof Date?e.value&&e.value instanceof Date&&t.getTime()===e.value.getTime()?[e.value,!0]:[t,!1]:r(e.value,t)?[e.value,!0]:[t,!1]:typeof t=="function"?[$(t),!1]:[t,!1]}function L(e,t,r,n){let o;const s=_(),i=C(n||"strict"),u=()=>r(...t.map(a=>a.getState())),h=()=>{if(s.size()>0){const a=u();(!o||!i(o.value,a))&&(o={value:a},s.emit())}else o=void 0};return t.forEach(a=>a.onChange(h)),A({name:e,dependencies:t,getState:()=>(o||(o={value:u()}),o.value),onChange:a=>s.on(a)})}function Y(e){const t=Object.assign(r=>()=>{const n=t.current;return t.current=r,()=>{t.current=n}},{current:e,override:r=>{t.current=r}});return t}function Z(e,t){const r=[];for(const n of e)r.push(n());try{return t()}finally{for(const n of r.reverse())n()}}const z=Object.assign(Y,{use:Z}),F=z(e=>e());function T(e,t,r,n,o,s="strict"){let i=t;const u=_(),h=C(s),y=_(),g=()=>i,a=m=>{if(typeof m=="function")return m({dispatch:a,domain:n,getState:g});const S=m,v={dispatch:a,domain:n,getState:g};y.emit({action:S,source:e,context:v});const k=i;i=r(i,S),h(i,k)||F.current(u.emit),o==null||o({action:S,source:e,context:v})},b=m=>{const S={dispatch:a,domain:n,getState:g};y.emit({action:m,source:e,context:S});const v=i;i=r(i,m),i!==v&&u.emit()};return A({name:e,getState:g,dispatch:a,onChange:u.on,onDispatch:y.on,_receiveDomainAction:b})}function x(){const e=new Map,t=new Map;return{get:(o,s)=>{const i=t.get(o)||o;if(e.has(i))return e.get(i);const u=i.create(s);return e.set(i,u),u},override:(o,s)=>{if(e.has(o))throw new Error(`Cannot override module: Instance already created for ${o.name}`);return t.set(o,s),()=>{t.delete(o)}}}}function R(e,t,r=x(),n){const o=new Set,s=new Set,i=_(),u=_(),h=()=>({dispatch:b,get:m}),y=c=>{u.emit(c),t==null||t(c)},g=c=>i.on(c),a=c=>{const l=i.on(c),f=u.on(c);return()=>{l(),f()}},b=c=>{if(typeof c=="function")return c(h());const l=c,f=h();i.emit({action:l,source:e,context:f}),o.forEach(p=>p._receiveDomainAction(l)),s.forEach(p=>p._receiveDomainAction(l)),t==null||t({action:l,source:e,context:f})},I=c=>{const l=h();i.emit({action:c,source:e,context:l}),o.forEach(f=>f._receiveDomainAction(c)),s.forEach(f=>f._receiveDomainAction(c))},m=c=>r.get(c,E),S=(c,l)=>r.override(c,l),v=(c,l,f,p)=>{const j=`${e}.${c}`;return L(j,l,f,p)};function k(c,l,f){const p=`${e}.${c}`,j=T(p,l,f,h(),y);return o.add(j),j}const E=A({name:e,root:null,dispatch:b,get:m,override:S,onDispatch:g,onAnyDispatch:a,store:k,derived:v,domain:c=>{const l=`${e}.${c}`,f=R(l,y,r,E.root);return s.add(f),f},_receiveDomainAction:I});return E.root=n??E,E}function P(e){return R(e)}const tt=(e,t)=>({name:e,create:t});let q=0;function et(e,t){if(q++,q===1){const r=_();try{return z.use([F(r.on)],e)}finally{q--,z.use([F(r.on)],()=>{const n=()=>{for(;r.size()>0;)r.emitAndClear()};t==="async"?requestAnimationFrame(n):n()})}}try{return e()}finally{q--}}function D(e,t){const r=(...n)=>({type:e,payload:t?t(...n):void 0});return r.type=e,r.match=n=>n.type===e,r}function V(e){const t={};for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)){const n=e[r];n===!0?t[r]=D(r):typeof n=="string"?t[r]=D(n):typeof n=="function"?t[r]=D(r,n):typeof n=="object"&&n!==null&&(t[r]=D(n.type,n.prepare))}return t}V.reducer=function(t,r){return r};exports.actions=V;exports.batch=et;exports.createStableFn=$;exports.deepEqual=O;exports.derived=L;exports.domain=P;exports.emitter=_;exports.equality=W;exports.isStableFn=H;exports.module=tt;exports.resolveEquality=C;exports.shallow2Equal=N;exports.shallow3Equal=B;exports.shallowEqual=w;exports.strictEqual=U;exports.tryStabilize=X;exports.withUse=A;
