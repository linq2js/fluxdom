"use strict";var K=Object.defineProperty;var Q=(e,t,r)=>t in e?K(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var h=(e,t,r)=>Q(e,typeof t!="symbol"?t+"":t,r);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});function E(e){return Object.assign(e,{use(t){const r=t(e);return r?typeof r=="object"||typeof r=="function"?"use"in r?r:E(r):r:e}})}function T(e,t){const r={};for(const o of Object.keys(e))r[o]=(...s)=>({type:o,args:s});return{actionCreators:r,reducer:(o,s)=>{const i=e[s.type];if(i)return i(o,...s.args);let c=o;for(const l of t)c=l(c,s);return c}}}function W(e,t,r={}){const n={};for(const[i,c]of Object.entries(t))n[i]=(...l)=>{e.dispatch(c(...l))};const o={};for(const[i,c]of Object.entries(r))o[i]=(...l)=>e.dispatch(c(...l));return E({...e,...n,...o})}function X(e){const t=[];return{ctx:{reset:()=>e,set:(n,o)=>o,fallback:n=>{t.push(n)}},fallbackHandlers:t}}function Y(e,t){const{name:r,initial:n,actions:o,thunks:s,equals:i}=t,{ctx:c,fallbackHandlers:l}=X(n),y=o(c),{actionCreators:g,reducer:a}=T(y,l),_=e(r,n,a,i),k={actions:g,initial:n},m=(s==null?void 0:s(k))??{};return W(_,g,m)}const Z=()=>{};class x{constructor(t){h(this,"_listeners");h(this,"_settledPayload");h(this,"_isSettled",!1);h(this,"size",()=>this._listeners.size);h(this,"settled",()=>this._isSettled);h(this,"on",(t,r)=>{let n;if(r===void 0)n=Array.isArray(t)?t:[t];else{const s=t,i=Array.isArray(r)?r:[r];n=[c=>{const l=s(c);if(l)for(let y=0;y<i.length;y++)i[y](l.value)}]}if(this._isSettled){const s=this._settledPayload;for(let i=0;i<n.length;i++)n[i](s);return Z}const o=this._listeners;for(let s=0;s<n.length;s++)o.add(n[s]);return()=>{for(let s=0;s<n.length;s++)o.delete(n[s])}});h(this,"emit",t=>{this._isSettled||this._doEmit(t,!1,!1)});h(this,"emitLifo",t=>{this._isSettled||this._doEmit(t,!1,!0)});h(this,"clear",()=>{this._listeners.clear()});h(this,"emitAndClear",t=>{this._isSettled||this._doEmit(t,!0,!1)});h(this,"emitAndClearLifo",t=>{this._isSettled||this._doEmit(t,!0,!0)});h(this,"settle",t=>{this._isSettled||(this._settledPayload=t,this._isSettled=!0,this._doEmit(t,!0,!1))});h(this,"_doEmit",(t,r,n)=>{const o=this._listeners,s=o.size;if(s===0)return;const i=Array.from(o);if(r&&o.clear(),n)for(let c=s-1;c>=0;c--)i[c](t);else for(let c=0;c<s;c++)i[c](t)});this._listeners=new Set(t)}}function b(e){return new x(e)}function U(e,t){return Object.is(e,t)}function w(e,t,r=Object.is){if(Object.is(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;const n=Object.keys(e),o=Object.keys(t);if(n.length!==o.length)return!1;for(const s of n)if(!Object.prototype.hasOwnProperty.call(t,s)||!r(e[s],t[s]))return!1;return!0}function H(e,t){return w(e,t,w)}function B(e,t){return w(e,t,H)}function D(e,t){if(Object.is(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let o=0;o<e.length;o++)if(!D(e[o],t[o]))return!1;return!0}if(Array.isArray(t))return!1;const r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(const o of r)if(!Object.prototype.hasOwnProperty.call(t,o)||!D(e[o],t[o]))return!1;return!0}function F(e){return!e||e==="strict"?U:e==="shallow"?w:e==="shallow2"?H:e==="shallow3"?B:e==="deep"?D:e}function P(e){return F(e)}function z(e){const t=e;let r=e;return Object.assign((...n)=>r(...n),{getOriginal:()=>t,getCurrent:()=>r,setCurrent(n){r=n}})}function L(e){return typeof e=="function"&&"getOriginal"in e&&"getCurrent"in e&&"setCurrent"in e}function tt(e,t,r){return e?typeof t=="function"?L(e.value)?(e.value.setCurrent(t),[e.value,!0]):[z(t),!1]:t&&t instanceof Date?e.value&&e.value instanceof Date&&t.getTime()===e.value.getTime()?[e.value,!0]:[t,!1]:r(e.value,t)?[e.value,!0]:[t,!1]:typeof t=="function"?[z(t),!1]:[t,!1]}function R(e,t,r,n){let o;const s=b(),i=F(n||"strict"),c=()=>r(...t.map(a=>a.getState())),l=()=>{if(s.size()>0){const a=c();(!o||!i(o.value,a))&&(o={value:a},s.emit())}else o=void 0};return t.forEach(a=>a.onChange(l)),E({name:e,dependencies:t,getState:()=>(o||(o={value:c()}),o.value),onChange:a=>s.on(a)})}function et(e){const t=Object.assign(r=>()=>{const n=t.current;return t.current=r,()=>{t.current=n}},{current:e,override:r=>{t.current=r}});return t}function rt(e,t){const r=[];for(const n of e)r.push(n());try{return t()}finally{for(const n of r.reverse())n()}}const M=Object.assign(et,{use:rt}),N=M(e=>e());function nt(e,t,r,n,o,s="strict"){let i=t;const c=b(),l=F(s),y=b(),g=()=>i,a=m=>{if(typeof m=="function")return m({dispatch:a,domain:n,getState:g});const p=m,v={dispatch:a,domain:n,getState:g};y.emit({action:p,source:e,context:v});const q=i;i=r(i,p),l(i,q)||N.current(c.emit),o==null||o({action:p,source:e,context:v})},_=m=>{const p={dispatch:a,domain:n,getState:g};y.emit({action:m,source:e,context:p});const v=i;i=r(i,m),i!==v&&c.emit()};return E({name:e,getState:g,dispatch:a,onChange:c.on,onDispatch:y.on,_receiveDomainAction:_})}function ot(){const e=new Map,t=new Map;return{get:(o,s)=>{const i=t.get(o)||o;if(e.has(i))return e.get(i);const c=i.create(s);return e.set(i,c),c},override:(o,s)=>{if(e.has(o))throw new Error(`Cannot override module: Instance already created for ${o.name}`);return t.set(o,s),()=>{t.delete(o)}}}}function V(e,t,r=ot(),n){const o=new Set,s=new Set,i=b(),c=b(),l=()=>({dispatch:_,get:m}),y=u=>{c.emit(u),t==null||t(u)},g=u=>i.on(u),a=u=>{const f=i.on(u),d=c.on(u);return()=>{f(),d()}},_=u=>{if(typeof u=="function")return u(l());const f=u,d=l();i.emit({action:f,source:e,context:d}),o.forEach(S=>S._receiveDomainAction(f)),s.forEach(S=>S._receiveDomainAction(f)),t==null||t({action:f,source:e,context:d})},k=u=>{const f=l();i.emit({action:u,source:e,context:f}),o.forEach(d=>d._receiveDomainAction(u)),s.forEach(d=>d._receiveDomainAction(u))},m=u=>r.get(u,A),p=(u,f)=>r.override(u,f),v=(u,f,d,S)=>{const j=`${e}.${u}`;return R(j,f,d,S)};function q(u){const{name:f,initial:d,reducer:S,equals:j}=u,$=`${e}.${f}`,I=nt($,d,S,l(),y,j);return o.add(I),I}const A=E({name:e,root:null,dispatch:_,get:m,override:p,onDispatch:g,onAnyDispatch:a,store:q,derived:v,domain:u=>{const f=`${e}.${u}`,d=V(f,y,r,A.root);return s.add(d),d},model:u=>Y((d,S,j,$)=>q({name:d,initial:S,reducer:j,equals:$}),u),_receiveDomainAction:k});return A.root=n??A,A}function st(e){return V(e)}const it=(e,t)=>({name:e,create:t});let C=0;function ct(e,t){if(C++,C===1){const r=b();try{return M.use([N(r.on)],e)}finally{C--,M.use([N(r.on)],()=>{const n=()=>{for(;r.size()>0;)r.emitAndClear()};t==="async"?requestAnimationFrame(n):n()})}}try{return e()}finally{C--}}function O(e,t){const r=(...n)=>({type:e,payload:t?t(...n):void 0});return r.type=e,r.match=n=>n.type===e,r}function G(e){const t={};for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)){const n=e[r];n===!0?t[r]=O(r):typeof n=="string"?t[r]=O(n):typeof n=="function"?t[r]=O(r,n):typeof n=="object"&&n!==null&&(t[r]=O(n.type,n.prepare))}return t}G.reducer=function(t,r){return r};exports.actions=G;exports.batch=ct;exports.createStableFn=z;exports.deepEqual=D;exports.derived=R;exports.domain=st;exports.emitter=b;exports.equality=P;exports.isStableFn=L;exports.module=it;exports.resolveEquality=F;exports.shallow2Equal=H;exports.shallow3Equal=B;exports.shallowEqual=w;exports.strictEqual=U;exports.tryStabilize=tt;exports.withUse=E;
