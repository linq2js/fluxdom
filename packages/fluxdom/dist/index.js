"use strict";var J=Object.defineProperty;var K=(t,e,r)=>e in t?J(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var d=(t,e,r)=>K(t,typeof e!="symbol"?e+"":e,r);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});function A(t){return Object.assign(t,{use(e){const r=e(t);return r?typeof r=="object"||typeof r=="function"?"use"in r?r:A(r):r:t}})}const Q=()=>{};class W{constructor(e){d(this,"_listeners");d(this,"_settledPayload");d(this,"_isSettled",!1);d(this,"size",()=>this._listeners.size);d(this,"settled",()=>this._isSettled);d(this,"on",(e,r)=>{let n;if(r===void 0)n=Array.isArray(e)?e:[e];else{const s=e,i=Array.isArray(r)?r:[r];n=[u=>{const h=s(u);if(h)for(let m=0;m<i.length;m++)i[m](h.value)}]}if(this._isSettled){const s=this._settledPayload;for(let i=0;i<n.length;i++)n[i](s);return Q}const o=this._listeners;for(let s=0;s<n.length;s++)o.add(n[s]);return()=>{for(let s=0;s<n.length;s++)o.delete(n[s])}});d(this,"emit",e=>{this._isSettled||this._doEmit(e,!1,!1)});d(this,"emitLifo",e=>{this._isSettled||this._doEmit(e,!1,!0)});d(this,"clear",()=>{this._listeners.clear()});d(this,"emitAndClear",e=>{this._isSettled||this._doEmit(e,!0,!1)});d(this,"emitAndClearLifo",e=>{this._isSettled||this._doEmit(e,!0,!0)});d(this,"settle",e=>{this._isSettled||(this._settledPayload=e,this._isSettled=!0,this._doEmit(e,!0,!1))});d(this,"_doEmit",(e,r,n)=>{const o=this._listeners,s=o.size;if(s===0)return;const i=Array.from(o);if(r&&o.clear(),n)for(let u=s-1;u>=0;u--)i[u](e);else for(let u=0;u<s;u++)i[u](e)});this._listeners=new Set(e)}}function b(t){return new W(t)}function M(t,e){return Object.is(t,e)}function v(t,e,r=Object.is){if(Object.is(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;const n=Object.keys(t),o=Object.keys(e);if(n.length!==o.length)return!1;for(const s of n)if(!Object.prototype.hasOwnProperty.call(e,s)||!r(t[s],e[s]))return!1;return!0}function z(t,e){return v(t,e,v)}function N(t,e){return v(t,e,z)}function q(t,e){if(Object.is(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let o=0;o<t.length;o++)if(!q(t[o],e[o]))return!1;return!0}if(Array.isArray(e))return!1;const r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(const o of r)if(!Object.prototype.hasOwnProperty.call(e,o)||!q(t[o],e[o]))return!1;return!0}function C(t){return!t||t==="strict"?M:t==="shallow"?v:t==="shallow2"?z:t==="shallow3"?N:t==="deep"?q:t}function X(t){return C(t)}function k(t){const e=t;let r=t;return Object.assign((...n)=>r(...n),{getOriginal:()=>e,getCurrent:()=>r,setCurrent(n){r=n}})}function U(t){return typeof t=="function"&&"getOriginal"in t&&"getCurrent"in t&&"setCurrent"in t}function Y(t,e,r){return t?typeof e=="function"?U(t.value)?(t.value.setCurrent(e),[t.value,!0]):[k(e),!1]:e&&e instanceof Date?t.value&&t.value instanceof Date&&e.getTime()===t.value.getTime()?[t.value,!0]:[e,!1]:r(t.value,e)?[t.value,!0]:[e,!1]:typeof e=="function"?[k(e),!1]:[e,!1]}function B(t,e,r,n){let o;const s=b(),i=C(n||"strict"),u=()=>r(...e.map(a=>a.getState())),h=()=>{if(s.size()>0){const a=u();(!o||!i(o.value,a))&&(o={value:a},s.emit())}else o=void 0};return e.forEach(a=>a.onChange(h)),A({name:t,dependencies:e,getState:()=>(o||(o={value:u()}),o.value),onChange:a=>s.on(a)})}function Z(t){const e=Object.assign(r=>()=>{const n=e.current;return e.current=r,()=>{e.current=n}},{current:t,override:r=>{e.current=r}});return e}function T(t,e){const r=[];for(const n of t)r.push(n());try{return e()}finally{for(const n of r.reverse())n()}}const F=Object.assign(Z,{use:T}),$=F(t=>t());function P(t,e,r,n,o,s="strict"){let i=e;const u=b(),h=C(s),m=b(),g=()=>i,a=y=>{if(typeof y=="function")return y({dispatch:a,domain:n,getState:g});const S=y,E={dispatch:a,domain:n,getState:g};m.emit({action:S,source:t,context:E});const D=i;i=r(i,S),h(i,D)||$.current(u.emit),o==null||o({action:S,source:t,context:E})},w=y=>{const S={dispatch:a,domain:n,getState:g};m.emit({action:y,source:t,context:S});const E=i;i=r(i,y),i!==E&&u.emit()};return A({name:t,getState:g,dispatch:a,onChange:u.on,onDispatch:m.on,_receiveDomainAction:w})}function x(){const t=new Map,e=new Map;return{get:(o,s)=>{const i=e.get(o)||o;if(t.has(i))return t.get(i);const u=i.create(s);return t.set(i,u),u},override:(o,s)=>{if(t.has(o))throw new Error(`Cannot override module: Instance already created for ${o.name}`);return e.set(o,s),()=>{e.delete(o)}}}}function H(t,e,r=x(),n){const o=new Set,s=new Set,i=b(),u=b(),h=()=>({dispatch:w,get:y}),m=c=>{u.emit(c),e==null||e(c)},g=c=>i.on(c),a=c=>{const l=i.on(c),f=u.on(c);return()=>{l(),f()}},w=c=>{if(typeof c=="function")return c(h());const l=c,f=h();i.emit({action:l,source:t,context:f}),o.forEach(p=>p._receiveDomainAction(l)),s.forEach(p=>p._receiveDomainAction(l)),e==null||e({action:l,source:t,context:f})},R=c=>{const l=h();i.emit({action:c,source:t,context:l}),o.forEach(f=>f._receiveDomainAction(c)),s.forEach(f=>f._receiveDomainAction(c))},y=c=>r.get(c,_),S=(c,l)=>r.override(c,l),E=(c,l,f,p)=>{const j=`${t}.${c}`;return B(j,l,f,p)};function D(c,l,f){const p=`${t}.${c}`,j=P(p,l,f,h(),m);return o.add(j),j}const _=A({name:t,root:null,dispatch:w,get:y,override:S,onDispatch:g,onAnyDispatch:a,store:D,derived:E,domain:c=>{const l=`${t}.${c}`,f=H(l,m,r,_.root);return s.add(f),f},_receiveDomainAction:R});return _.root=n??_,_}function tt(t){return H(t)}const et=(t,e)=>({name:t,create:e});let O=0;function rt(t,e){if(O++,O===1){const r=b();try{return F.use([$(r.on)],t)}finally{O--,F.use([$(r.on)],()=>{const n=()=>{for(;r.size()>0;)r.emitAndClear()};e==="async"?requestAnimationFrame(n):n()})}}try{return t()}finally{O--}}function I(t){const e=(...r)=>({type:t,args:r});return Object.defineProperty(e,"type",{value:t,writable:!1}),e}function L(t){return(e,r)=>{const n=t[r.type];return n?n(e,...r.args||[]):e}}function V(t){const e={};for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=I(r));return e}function nt(t){return typeof t=="object"&&t!==null}function ot(t,e){const r=V(t),n=L(t);return Object.assign(r,{reducer:(s,i)=>"args"in i?n(s,i):e?e(s,i):s})}exports.actions=ot;exports.batch=rt;exports.createActionCreator=I;exports.createActionsFromMap=V;exports.createReducerFromMap=L;exports.createStableFn=k;exports.deepEqual=q;exports.derived=B;exports.domain=tt;exports.emitter=b;exports.equality=X;exports.isReducerMap=nt;exports.isStableFn=U;exports.module=et;exports.resolveEquality=C;exports.shallow2Equal=z;exports.shallow3Equal=N;exports.shallowEqual=v;exports.strictEqual=M;exports.tryStabilize=Y;exports.withUse=A;
